<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>mural de assinaturas</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#9aa4b2}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#031026 0%, #071126 100%);font-family:Inter,Segoe UI,Arial,sans-serif;color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:820px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{font-size:20px;margin:0}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}
    .card{background:rgba(255,255,255,0.03);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    form{display:flex;gap:8px;flex-wrap:wrap}
    input[type=text],textarea{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:14px}
    textarea{min-height:72px;resize:vertical}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:#022;cursor:pointer;font-weight:600}
    .small{font-size:12px;color:var(--muted);margin-top:8px}
    .list{margin-top:12px;display:grid;gap:8px}
    .entry{background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:8px;border-left:3px solid rgba(6,182,212,0.12)}
    .meta{font-size:12px;color:var(--muted);display:flex;justify-content:space-between}
    .name{font-weight:700}
    .controls{display:flex;gap:8px}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px;color:var(--muted);cursor:pointer}
    footer{margin-top:12px;color:var(--muted);font-size:12px}
    .notice{background:rgba(6,182,212,0.06);padding:8px;border-radius:8px;color:var(--accent);font-size:13px}
    @media (max-width:520px){h1{font-size:18px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>mural de assinaturas</h1>
        <p class="lead">cola tua assinatura.</p>
      </div>
      <div style="text-align:right">
        <div class="notice">versão: single-file.</div>
      </div>
    </header>

    <div class="card">
      <form id="frm">
        <input id="name" type="text" placeholder="seu nome (ou apelido) — opcional" maxlength="60">
        <textarea id="msg" placeholder="assinatura / recado — seja curto (max 300 chars)" maxlength="300"></textarea>
        <div style="width:100%;display:flex;gap:8px;justify-content:flex-end">
          <button id="post">assinar</button>
        </div>
      </form>

      <div class="small">dicas: não poste conteúdo ilegal nem doxing.</div>

      <div class="list" id="list"></div>

      <footer>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>total: <span id="count">0</span></div>
          <div class="controls">
            <button class="btn-ghost" id="export">exportar (json)</button>
            <button class="btn-ghost" id="clear">apagar tudo (local)</button>
          </div>
        </div>
        <div style="margin-top:8px;color:var(--muted);font-size:12px">

        </div>
      </footer>
    </div>
  </div>

  <script>
   
    const JSONBIN_ID = '692363fa43b1c97be9c07ee6' 
    const JSONBIN_KEY = '$2a$10$0VucZInx6G1KMn11z1JyBuvQCCHMKEGPwuGpWChE9rjno5A/mm13C' 
    const JSONBIN_BASE = 'https://api.jsonbin.io/v3/b'; 

    const STORAGE_KEY = 'mural_eterno_signatures_v1';

    // util
    const el = (id)=>document.getElementById(id);
    const nowIso = ()=>new Date().toISOString();

    // carregar assinaturas
    async function loadSignatures(){
      if(JSONBIN_ID){
        try{
          const res = await fetch(`${JSONBIN_BASE}/${JSONBIN_ID}/latest`);
          if(!res.ok) throw new Error('erro ao buscar bin');
          const data = await res.json();
          // jsonbin v3 wraps data.record
          const arr = data && data.record ? data.record : [];
          return Array.isArray(arr) ? arr : [];
        }catch(e){
          console.warn('jsonbin falhou, usando localStorage',e);
          return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        }
      }else{
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      }
    }

    async function saveSignatures(arr){
      if(JSONBIN_ID && JSONBIN_KEY){
        // bin
        try{
          const res = await fetch(`${JSONBIN_BASE}/${JSONBIN_ID}`,{
            method:'PUT',
            headers:{
              'Content-Type':'application/json',
              'X-Master-Key': JSONBIN_KEY
            },
            body: JSON.stringify(arr)
          });
          if(!res.ok) throw new Error('erro ao salvar no bin');
          return true;
        }catch(e){
          console.warn('falha ao salvar no jsonbin',e);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
          return false;
        }
      }else{
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
        return true;
      }
    }

    // ui
    function render(list){
      const container = el('list'); container.innerHTML='';
      list.slice().reverse().forEach((it,idx)=>{
        const div = document.createElement('div'); div.className='entry';
        const name = (it.name && it.name.trim()) ? it.name.trim() : 'anônimo';
        const text = (it.msg||'').replace(/</g,'&lt;');
        const time = new Date(it.t||it.time||nowIso()).toLocaleString();
        div.innerHTML = `<div style=\"display:flex;justify-content:space-between;align-items:center\"><div class=\"name\">${escapeHtml(name)}</div><div class=\"meta\">${time}</div></div><div style=\"margin-top:6px;font-size:15px;line-height:1.25\">${text}</div>`;
        container.appendChild(div);
      });
      el('count').textContent = list.length;
    }

    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // events
    document.getElementById('frm').addEventListener('submit', async (ev)=>{
      ev.preventDefault();
      const name = el('name').value.trim();
      const msg = el('msg').value.trim();
      if(!msg){ alert('coloca uma mensagem, burro'); return; }
      const sig = {name, msg, t: nowIso()};
      // load, push, save, render
      const list = await loadSignatures();
      list.push(sig);
      await saveSignatures(list);
      render(list);
      el('msg').value='';
    });

    el('clear').addEventListener('click', ()=>{
      if(!confirm('apagar tudo local? isso n apaga se estiver salvo num bin remoto.')) return;
      localStorage.removeItem(STORAGE_KEY);
      render([]);
    });

    el('export').addEventListener('click', async ()=>{
      const list = await loadSignatures();
      const blob = new Blob([JSON.stringify(list,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='mural_signatures.json'; a.click(); URL.revokeObjectURL(url);
    });

    // init
    (async ()=>{
      const list = await loadSignatures();
      render(list);
    })();

  </script>
</body>
</html>


